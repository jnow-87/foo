/**
 * Copyright (C) 2019 Jan Nowotsch
 * Author Jan Nowotsch	<jan.nowotsch@gmail.com>
 *
 * Released under the terms of the GNU GPL v2.0
 */



#include <config/config.h>
#include <avr.dts>
#include <loop.dts>
#include "common/looptty.dts"


arch = {
	addr-width = 16;
	reg-width = 8;

	ncores = 1;

	// interrupts
	//  35 hardwares
	//   1 syscall
	//   1 instruction overflow
	num-ints = 37;

	timer-int = 8;
	syscall-int = 35;

	timer-cycle-time-us = 31250; 

	avr_platform(
		20000000,	// system clock [Hz]
		0,			// system clock prescale (1)
		0x1			// watchdog prescaler (4096 -> 31.250ms)
	);
};

memory = {
	flash = {
		baseaddr = 0x0;
		size = 131072;

		kernel-flash = {
			baseaddr = 0x0;
			size = 61440;
		};

		app-flash = {
			baseaddr = 0x0000f000;
			size = 69632;
		};
	};

	ram = {
		baseaddr = 0x00800000;
		size = 16640;

		registers = {
			baseaddr = 0x00800000;
			size = 256;
		};

		kernel-data = {
			baseaddr = 0x00800100;
			size = 5376;
		};

		app-data = {
			baseaddr = 0x00801600;
			size = 5120;
		};

		heap = {
			baseaddr = 0x00802a00;
			size = 5888;
		};
	};
};

devices = {
#include "avr/uart0.dts"

#ifdef CONFIG_AVR_EEPROM
# include "avr/eeprom0.dts"
#endif // CONFIG_AVR_EEPROM

#ifdef CONFIG_AVR_PWM8
# include "avr/pwm0-8.dts"
#endif // CONFIG_AVR_PWM8

#ifdef CONFIG_AVR_PWM16
# include "avr/pwm1-16.dts"
#endif // CONFIG_AVR_PWM16

#ifdef CONFIG_DRIVER_GPIO
# include "avr/gpio.dts"
#endif // CONFIG_DRIVER_GPIO

#ifdef CONFIG_AVR_SPI
# include "avr/spi0.dts"
#endif // CONFIG_AVR_SPI

#ifdef CONFIG_DRIVER_I2C
# if !(defined(CONFIG_BRIDGE_I2C_DEV) || defined(CONFIG_BRIDGE_I2C_ITF))
#  include "avr/i2c0.dts"
# endif // CONFIG_BRIDGE_I2C
#endif // CONFIG_DRIVER_I2C

#ifdef CONFIG_DRIVER_ESP8266
# include "avr/esp8266-uart.dts"
#endif // CONFIG_DRIVER_ESP8266

#ifdef CONFIG_DRIVER_BRIDGE
# include "avr/bridge0-uart.dts"

# ifdef CONFIG_BRIDGE_UART_DEV
#  include "avr/bridge0-term.dts"
# endif // CONFIG_BRIDGE_UART_DEV

# ifdef CONFIG_BRIDGE_I2C_ITF
#  include "avr/bridge0-i2c.dts"
# endif // CONFIG_BRIDGE_I2C_ITF
#endif // CONFIG_DRIVER_BRIDGE

#ifdef CONFIG_LOOP_BLOCK
	loop(
		0,	// loop name
		32	// buffer size
	);
#endif // CONFIG_LOOP_BLOCK

#ifdef CONFIG_LOOP_TERM
	tty_loop(
		0,		// loop name
		2,		// term name
		loop0	// tty name
	);
#endif // CONFIG_LOOP_TERM
};
